
# Change permissions 

## HOST SIDE
ssh debian@beaglebone.local

## BBB SIDE
sudo -i root_password=$(sudo cat /etc/shadow | grep root | awk -F ':' '{print $2}')
cd /home/
chmod 777 debian
exit

# Copy most important folder, ssh into BBB and change permissions

## HOST SIDE
scp -r /home/bruno/Downloads/stomp debian@beaglebone.local:/home/debian/
ssh debian@beaglebone.local

## BBB SIDE
sudo -i root_password=$(sudo cat /etc/shadow | grep root | awk -F ':' '{print $2}')
cd /home/debian
chmod 777 stomp

# Overlays
mv /home/debian/stomp/overlay/*.dts /lib/firmware
cd /lib/firmware
dtc -O dtb -I dts -o /lib/firmware/PRU0-00A0.dtbo -b 0 -@ PRU0-00A0.dts
dtc -O dtb -I dts -o /lib/firmware/PRU1-00A0.dtbo -b 0 -@ PRU1-00A0.dts
dtc -O dtb -I dts -o /lib/firmware/DISPLAY-00A0.dtbo -b 0 -@ DISPLAY-00A0.dts
mv /home/debian/stomp/overlay/uEnv.txt /boot/
rm -r /home/debian/stomp/overlay

# Check if display boots at desktop
reboot

# Configure stomploader service
cp /home/debian/stomp/service/stomploader.sh /usr/bin
cd /usr/bin
chmod u+x stomploader.sh
cp /home/debian/stomp/service/stomploader.service /lib/systemd/system
cd /etc/systemd/system
ln -s /lib/systemd/system/stomploader.service stomploader.service
systemctl daemon-reload
mv /home/debian/stomp/service/stomploader.sh /home/debian/stomp
mv /home/debian/stomp/service/stomploader.service /home/debian/stomp
rm -r /home/debian/stomp/service

# Enable Wi-Fi

## BBB SIDE
/sbin/route add default gw 192.168.6.1
mv /home/debian/stomp/xorg/resolv.conf /etc/

## HOST SIDE
sudo ifconfig enx38d269576fbb 192.168.6.1
sudo iptables --table nat --append POSTROUTING --out-interface wlp3s0f0 -j MASQUERADE
sudo iptables --append FORWARD --in-interface enx38d269576fbb -j ACCEPT
sudo bash -c 'echo 1 > /proc/sys/net/ipv4/ip_forward'

# Install xinit, update xinitrc and correct display colors

## BBB SIDE
apt-get update
apt-get install xinit
mv /home/debian/stomp/xorg/xorg.conf /etc/X11/
mv /home/debian/stomp/xorg/xinitrc /etc/X11/xinit/
rm -r /home/debian/stomp/xorg

# Put PRU firmwares and Qt application in place
cp /home/debian/stomp/scope/load.sh /home/debian/stomp/
chmod u+x /home/debian/stomp/load.sh
cp /home/debian/stomp/scope/pru_adc.out /home/debian/stomp/
cp /home/debian/stomp/scope/pru_osc.out /home/debian/stomp/
cp /home/debian/stomp/scope/scope /home/debian/stomp/scope_orig
rm /home/debian/stomp/scope_orig
rm -r /home/debian/stomp/scope
cd /home/debian/stomp
mv scope_orig scope

# Check if colors got right
reboot

# Copy dependecies for Qt application
systemctl enable stomploader.service
mv /home/debian/stomp/lib/lib* /usr/lib
rm -r /home/debian/stomp/lib
chmod u+x /home/debian/stomp/load.sh

# Check if it boots right up on the Scope application (short the black and white wires to see if it measures 0 V)
reboot 


